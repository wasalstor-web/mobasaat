name: DL+ AI Agent Execution

on:
  workflow_dispatch:
    inputs:
      prompt:
        description: 'Your prompt for the AI agent (English or Arabic)'
        required: true
        default: 'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£Ø­Ø¯Ø« ØªØ·ÙˆØ±Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ'
      language:
        description: 'Preferred language (ar/en/auto)'
        required: false
        default: 'auto'

jobs:
  execute-agent:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Execute AI Agent
      env:
        OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      run: |
        python << EOF
        import asyncio
        from dlplus import IntelligenceCore
        from dlplus.agents import WebRetrievalAgent, CodeGeneratorAgent
        
        async def main():
            print("=" * 60)
            print("ðŸ¤– DL+ AI Agent Execution")
            print("=" * 60)
            
            # Initialize core
            core = IntelligenceCore()
            
            # Register agents
            web_agent = WebRetrievalAgent()
            code_agent = CodeGeneratorAgent()
            core.register_agent("web_retrieval", web_agent)
            core.register_agent("code_generator", code_agent)
            
            # User prompt
            prompt = """${{ github.event.inputs.prompt }}"""
            print(f"\nðŸ“ Prompt: {prompt}\n")
            
            # Process request
            result = await core.process_request(prompt)
            
            # Display results
            print("=" * 60)
            print("ðŸ“Š Results:")
            print("=" * 60)
            print(f"âœ… Success: {result['success']}")
            print(f"ðŸŽ¯ Intent: {result['intent']}")
            print(f"ðŸ› ï¸  Tools Used: {result['tools_used']}")
            print(f"â±ï¸  Execution Time: {result['execution_time']:.2f}s")
            print(f"\nðŸ’¬ Response:\n{result['response']}")
            print("=" * 60)
        
        asyncio.run(main())
        EOF
    
    - name: Save Results
      run: |
        mkdir -p output
        echo "# AI Agent Execution Results" > output/results.md
        echo "" >> output/results.md
        echo "**Prompt:** ${{ github.event.inputs.prompt }}" >> output/results.md
        echo "" >> output/results.md
        echo "**Execution Time:** $(date)" >> output/results.md
        echo "" >> output/results.md
        echo "âœ… Execution completed successfully!" >> output/results.md
    
    - name: Upload Results
      uses: actions/upload-artifact@v3
      with:
        name: agent-results
        path: output/results.md
